<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bài thuyết trình nhóm 2</title>

  <!-- Import map cho Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.152.2/build/three.module.js",
      "three/addons/controls/OrbitControls.js": "https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js",
      "three/examples/jsm/loaders/FontLoader.js": "https://unpkg.com/three@0.152.2/examples/jsm/loaders/FontLoader.js",
      "three/examples/jsm/geometries/TextGeometry.js": "https://unpkg.com/three@0.152.2/examples/jsm/geometries/TextGeometry.js"
    }
  }
  </script>

  <!-- RESET & STYLE CŨ + STYLE MỚI -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%;overflow:hidden;background:#000}

    /* Màn hình yêu cầu bật âm thanh */
    #sound-gate{position:fixed;inset:0;background:url('back.jpeg') no-repeat center/cover;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:999999;font-family:sans-serif;text-align:center}
    #sound-gate h1{font-size:2rem;margin-bottom:1rem}
    #unlock-sound{padding:.75rem 1.5rem;font-size:1.2rem;cursor:pointer;border:none;background:#fff;color:#000;border-radius:4px}
    #unlock-sound:hover{background:#ddd}

    /* Video intro */
    #intro-video{position:fixed;inset:0;background:#000;z-index:9999;display:flex;justify-content:center;align-items:center}
    #intro-video video{width:100%;height:100%;object-fit:cover}

    /* Nội dung chính */
    #main-content{display:none;width:100%;height:100%}
    #container{width:100%;height:100%}

    /* Nút ẩn góc trên-phải */
    #hidden-corner-btn{position:fixed;top:8px;right:8px;width:32px;height:32px;opacity:0;cursor:pointer;z-index:999999;border:none;background:transparent}

    /* Layer video full-screen */
    #video-layer{position:fixed;inset:0;width:100vw;height:100vh;background:#000;display:none;z-index:9999999;justify-content:center;align-items:center}
    #video-layer video{width:100%;height:100%;object-fit:cover}
  </style>
</head>
<body>
  <!-- Màn hình yêu cầu bật âm thanh -->
  <div id="sound-gate">
    <h1>Project Group 2</h1>
    <p>Nhấn để bắt đầu để thằng hoa cảm xúc!</p>
    <button id="unlock-sound">Bắt đầu</button>
  </div>

  <!-- Video intro -->
  <div id="intro-video">
    <video id="intro" muted playsinline>
      <source src="videogioithieu.mp4" type="video/mp4">
      <source src="videogioithieu.webm" type="video/webm">
      Trình duyệt không hỗ trợ video.
    </video>
  </div>

  <!-- Nội dung chính -->
  <div id="main-content">
    <audio id="bg-music" loop>
      <source src="music.mp3" type="audio/mpeg">
    </audio>
    <div id="container"></div>
    <script type="module" src="script.js"></script>
  </div>

  <!-- Nút ẩn & video full -->
  <button id="hidden-corner-btn"></button>
  <div id="video-layer">
    <video id="fullvideo" src="video-hidden.mp4" playsinline></video>
  </div>

  <!-- Xử lý âm thanh & chuyển màn hình + NÚT ẨN + VIDEO FULL -->
  <script>
    const intro = document.getElementById('intro');
    const bgMusic = document.getElementById('bg-music');
    const soundGate = document.getElementById('sound-gate');
    const unlockBtn = document.getElementById('unlock-sound');

    unlockBtn.addEventListener('click', () => {
      intro.muted = false;
      bgMusic.muted = false;
      intro.play();
      bgMusic.play();
      soundGate.style.display = 'none';
    }, { once: true });

    intro.addEventListener('ended', () => {
      document.getElementById('intro-video').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      showHiddenBtn();            // ← hiện nút ẩn
    });

    /* ---------- Video full-screen ẩn ---------- */
const videoLayer = document.getElementById('video-layer');
const fullVideo  = document.getElementById('fullvideo');
const cornerBtn  = document.getElementById('hidden-corner-btn');

function showHiddenBtn() {
  cornerBtn.style.opacity = 0.08;
}

cornerBtn.addEventListener('click', () => {
  // 1. Tắt hết âm thanh đang chạy
  bgMusic.pause();
  if (window.galaxyAudio) window.galaxyAudio.pause();

  // 2. Mở layer và phát video
  videoLayer.style.display = 'flex';
  fullVideo.currentTime = 0;
  fullVideo.play();
  fullVideo.onended = hideVideoLayer;
});

videoLayer.addEventListener('click', hideVideoLayer);
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') hideVideoLayer();
});

function hideVideoLayer() {
  fullVideo.pause();
  videoLayer.style.display = 'none';

  // 3. Trả lại âm thanh 3D
  bgMusic.play();
  if (window.galaxyAudio) window.galaxyAudio.play();
}
  </script>
</body>
</html>